{% extends "base.html" %}
{% block title %}ลงทะเบียนสำเร็จ{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-2xl shadow-md p-8 text-center mb-6">
        <div class="text-6xl mb-4">&#x2705;</div>
        <h1 class="text-2xl font-bold text-gray-800 mb-6">ลงทะเบียนสำเร็จ!</h1>
        <p class="text-gray-500 mb-4">รหัสลูกค้าของคุณ</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
            <div class="bg-amber-50 border-2 border-amber-200 rounded-xl p-5">
                <div class="text-xs font-semibold text-amber-400 uppercase tracking-wider mb-2">&#x2708;&#xfe0f; Air Freight</div>
                <div class="bg-amber-500 text-white text-2xl font-bold py-3 px-6 rounded-lg inline-block font-mono">{{ customer.customer_code }}</div>
            </div>
            <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-5">
                <div class="text-xs font-semibold text-blue-400 uppercase tracking-wider mb-2">&#x1f6a2; Sea Freight</div>
                <div class="bg-blue-500 text-white text-2xl font-bold py-3 px-6 rounded-lg inline-block font-mono">{{ customer.sea_code }}</div>
            </div>
        </div>

        <!-- Location badge -->
        <div class="mb-4">
            {% if customer.location_type == 'us' %}
                <span class="inline-block bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-semibold">&#x1f1fa;&#x1f1f8; {{ US_CITIES.get(customer.city, customer.city) }}</span>
            {% else %}
                <span class="inline-block bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold">&#x1f1f9;&#x1f1ed; ลูกค้าไทย</span>
            {% endif %}
        </div>

        <p class="text-sm text-gray-400 mb-2">Tier: <span class="bg-orange-200 text-orange-800 px-2 py-0.5 rounded text-xs font-bold">Bronze</span></p>
        <p class="text-sm text-gray-400 mb-6">กรุณาจดจำรหัสทั้งสอง ใช้สำหรับติดตามพัสดุ</p>
        <div class="flex gap-3 justify-center">
            <a href="/customer/{{ customer.customer_code }}" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition-colors">ดูสถานะพัสดุ</a>
            <a href="/register" class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors">สมัครอีกคน</a>
        </div>
    </div>

    {% if customer.location_type == 'us' %}
    <!-- US Customer: Show warehouse address cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div class="bg-amber-50 border border-amber-200 rounded-2xl p-5">
            <h2 class="text-base font-bold text-amber-800 mb-2">&#x2708;&#xfe0f; ที่อยู่สำหรับ Air Freight</h2>
            <p class="text-xs text-amber-600 mb-3">ใช้เป็น Shipping Address เมื่อส่งทางอากาศ</p>
            <div class="bg-white rounded-xl p-4 font-mono text-sm leading-relaxed border border-amber-100 relative">
                <button onclick="copyAddress('air')" class="absolute top-2 right-2 px-3 py-1 bg-amber-500 text-white text-xs rounded-lg hover:bg-amber-600 transition-colors" id="copy-btn-air">&#x1f4cb; Copy</button>
                <div id="address-air">
                    <p class="font-bold text-gray-800">{{ customer.sender_first_name }} {{ customer.sender_last_name }} <span class="text-amber-600">{{ customer.customer_code }}</span></p>
                    <p class="text-gray-600">{{ customer.sender_address }}</p>
                    <p class="text-gray-600">{{ customer.sender_phone }}</p>
                </div>
            </div>
            <p class="text-xs text-amber-600 mt-2">&#x26a0;&#xfe0f; ใส่รหัส <strong>{{ customer.customer_code }}</strong> ต่อท้ายชื่อเสมอ</p>
        </div>
        <div class="bg-blue-50 border border-blue-200 rounded-2xl p-5">
            <h2 class="text-base font-bold text-blue-800 mb-2">&#x1f6a2; ที่อยู่สำหรับ Sea Freight</h2>
            <p class="text-xs text-blue-600 mb-3">ใช้เป็น Shipping Address เมื่อส่งทางเรือ</p>
            <div class="bg-white rounded-xl p-4 font-mono text-sm leading-relaxed border border-blue-100 relative">
                <button onclick="copyAddress('sea')" class="absolute top-2 right-2 px-3 py-1 bg-blue-500 text-white text-xs rounded-lg hover:bg-blue-600 transition-colors" id="copy-btn-sea">&#x1f4cb; Copy</button>
                <div id="address-sea">
                    <p class="font-bold text-gray-800">{{ customer.sender_first_name }} {{ customer.sender_last_name }} <span class="text-blue-600">{{ customer.sea_code }}</span></p>
                    <p class="text-gray-600">{{ customer.sender_address }}</p>
                    <p class="text-gray-600">{{ customer.sender_phone }}</p>
                </div>
            </div>
            <p class="text-xs text-blue-600 mt-2">&#x26a0;&#xfe0f; ใส่รหัส <strong>{{ customer.sea_code }}</strong> ต่อท้ายชื่อเสมอ</p>
        </div>
    </div>
    {% else %}
    <!-- TH Customer: BSS warehouse info -->
    <div class="bg-green-50 border border-green-200 rounded-2xl p-5 mb-4">
        <h2 class="text-base font-bold text-green-800 mb-2">&#x1f4e6; ข้อมูลการจัดส่ง</h2>
        <p class="text-sm text-green-700 mb-3">สำหรับลูกค้าไทย — BSS จะจัดส่งพัสดุจาก US มาตามที่อยู่ปลายทางของคุณ</p>
        <div class="bg-white rounded-xl p-4 text-sm leading-relaxed border border-green-100">
            <p class="text-gray-600">เมื่อมีพัสดุ กรุณาเข้าสู่ระบบเพื่อเลือกที่อยู่ปลายทางให้แต่ละ shipment</p>
            <p class="text-gray-600 mt-1">Air code: <span class="font-mono font-bold text-amber-600">{{ customer.customer_code }}</span> | Sea code: <span class="font-mono font-bold text-blue-600">{{ customer.sea_code }}</span></p>
        </div>
    </div>
    {% endif %}

    <!-- Destination Addresses -->
    {% if addresses %}
    <div class="bg-white rounded-2xl shadow-sm p-5 mb-4">
        <h2 class="text-base font-bold text-gray-800 mb-3">&#x1f4cd; ที่อยู่ปลายทางที่ลงทะเบียน</h2>
        <div class="space-y-3">
            {% for addr in addresses %}
            <div class="border border-gray-200 rounded-xl p-4 bg-gray-50">
                <div class="flex items-center gap-2 mb-1">
                    <span class="bg-amber-100 text-amber-700 px-2 py-0.5 rounded text-xs font-bold">{{ addr.nickname or 'ที่อยู่ ' ~ loop.index }}</span>
                    {% if addr.is_default %}<span class="text-xs text-green-600 font-medium">&#x2b50; หลัก</span>{% endif %}
                </div>
                <p class="text-sm font-medium text-gray-800">{{ addr.receiver_first_name }} {{ addr.receiver_last_name }}</p>
                <p class="text-sm text-gray-500">{{ addr.receiver_address }}</p>
                <p class="text-sm text-gray-400">{{ addr.receiver_phone }}</p>
            </div>
            {% endfor %}
        </div>
        <p class="text-xs text-gray-400 mt-3 text-center">สามารถเพิ่มที่อยู่เพิ่มเติมได้ในหน้า <a href="/customer/{{ customer.customer_code }}" class="text-amber-600 hover:underline">ลูกค้า</a></p>
    </div>
    {% endif %}
</div>

<script>
function copyAddress(type) {
    const code = type === 'air' ? "{{ customer.customer_code }}" : "{{ customer.sea_code }}";
    const text = "{{ customer.sender_first_name }} {{ customer.sender_last_name }} " + code + "\n{{ customer.sender_address }}\n{{ customer.sender_phone }}";
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copy-btn-' + type);
        btn.textContent = '\u2713 Copied!';
        setTimeout(() => btn.innerHTML = '&#x1f4cb; Copy', 2000);
    });
}
</script>
{% endblock %}
