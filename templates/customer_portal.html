{% extends "base.html" %}
{% block title %}พอร์ทัลลูกค้า — {{ customer.customer_code }}{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-3 flex-wrap">
        <h1 class="text-2xl font-bold text-gray-800">&#x1f464;</h1>
        <span class="bg-amber-100 text-amber-700 px-3 py-1 rounded-lg text-sm font-mono font-bold">&#x2708;&#xfe0f; {{ customer.customer_code }}</span>
        <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-sm font-mono font-bold">&#x1f6a2; {{ customer.sea_code }}</span>
        {% if customer.tier == 'vip' %}
            <span class="bg-yellow-400 text-white px-3 py-1 rounded-lg text-xs font-bold">&#x1f451; VIP</span>
        {% elif customer.tier == 'gold' %}
            <span class="bg-yellow-300 text-yellow-900 px-3 py-1 rounded-lg text-xs font-bold">&#x1f947; Gold</span>
        {% else %}
            <span class="bg-orange-200 text-orange-800 px-3 py-1 rounded-lg text-xs font-bold">&#x1f949; Bronze</span>
        {% endif %}
        {% if customer.location_type == 'us' %}
            <span class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded text-xs">US — {{ US_CITIES.get(customer.city, '') }}</span>
        {% else %}
            <span class="bg-green-50 text-green-600 px-2 py-0.5 rounded text-xs">TH</span>
        {% endif %}
    </div>
    <a href="/customer/logout" class="text-sm text-gray-500 hover:text-red-500">ออกจากระบบ</a>
</div>

<!-- US Sender → BSS Warehouse (US customers only) -->
{% if customer.location_type == 'us' %}
<div class="flex flex-col md:flex-row items-stretch gap-0 mb-4">
    <div class="flex-1 bg-white rounded-xl md:rounded-r-none shadow-sm p-6 border-2 border-amber-100">
        <h2 class="font-semibold text-amber-600 mb-3">&#x1f1fa;&#x1f1f8; ผู้ส่ง (อเมริกา)</h2>
        <div class="space-y-1 text-sm text-gray-700">
            <p><span class="text-gray-400">ชื่อผู้ส่ง:</span> <strong>{{ customer.sender_first_name }} {{ customer.sender_last_name }} {{ customer.customer_code }}</strong></p>
            <p><span class="text-gray-400">ที่อยู่:</span> {{ customer.sender_address }}</p>
            <p><span class="text-gray-400">โทร:</span> {{ customer.sender_phone }}</p>
        </div>
    </div>
    <div class="flex items-center justify-center py-3 md:py-0 md:px-2">
        <div class="flex flex-col items-center gap-1">
            <div class="hidden md:flex items-center">
                <div class="w-8 h-0.5 bg-amber-300"></div>
                <div class="bg-yellow-500 text-white rounded-full w-10 h-10 flex items-center justify-center text-lg">&#x1f4e6;</div>
                <div class="w-4 h-0.5 bg-amber-400"></div>
                <div class="text-amber-400 text-2xl">&#x2192;</div>
                <div class="w-4 h-0.5 bg-green-400"></div>
                <div class="bg-green-500 text-white rounded-full w-10 h-10 flex items-center justify-center text-lg">&#x1f3e2;</div>
                <div class="w-8 h-0.5 bg-green-300"></div>
            </div>
            <span class="text-xs text-gray-400 font-medium">Ship to BSS</span>
        </div>
    </div>
    <div class="flex-1 bg-white rounded-xl md:rounded-l-none shadow-sm p-6 border-2 border-green-100">
        <h2 class="font-semibold text-green-600 mb-3">&#x1f3e2; BSS Warehouse</h2>
        <div class="space-y-1 text-sm text-gray-700">
            <p><span class="text-gray-400">ผู้รับ:</span> <strong>BSS <span class="text-amber-600">{{ customer.customer_code }}</span></strong></p>
            <p><span class="text-gray-400">ที่อยู่:</span> 8707 Stansbury Ave. Van Nuys CA 91402</p>
            <p><span class="text-gray-400">โทร:</span> +1 (818) 437-2260</p>
        </div>
    </div>
</div>
{% else %}
<div class="bg-white rounded-xl shadow-sm mb-4 border-2 border-green-200 overflow-hidden">
    <div class="bg-green-50 px-6 py-4 border-b border-green-200">
        <h2 class="text-lg font-bold text-green-700">&#x1f3e2; BSS Warehouse — ที่อยู่สำหรับส่งของจาก US</h2>
        <p class="text-sm text-green-600 mt-1">สั่งของจากเว็บ US ให้กรอกที่อยู่นี้เป็น <strong>Shipping Address</strong></p>
    </div>
    <div class="p-6">
        <!-- Warehouse address card -->
        <div class="bg-green-50 border border-green-200 rounded-xl p-5 mb-5">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <p class="text-xs text-green-500 font-semibold uppercase tracking-wider mb-1">&#x2708;&#xfe0f; Air Freight</p>
                    <div class="bg-white rounded-lg p-4 border border-green-100 relative">
                        <button onclick="copyAddr('air')" class="absolute top-2 right-2 px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 transition-colors" id="copy-btn-air">&#x1f4cb; Copy</button>
                        <p class="font-bold text-gray-800 text-base">BSS <span class="text-amber-600">{{ customer.customer_code }}</span></p>
                        <p class="text-gray-600 text-sm mt-1">8707 Stansbury Ave.</p>
                        <p class="text-gray-600 text-sm">Van Nuys, CA 91402</p>
                        <p class="text-gray-600 text-sm mt-1">+1 (818) 437-2260</p>
                    </div>
                </div>
                <div>
                    <p class="text-xs text-blue-500 font-semibold uppercase tracking-wider mb-1">&#x1f6a2; Sea Freight</p>
                    <div class="bg-white rounded-lg p-4 border border-blue-100 relative">
                        <button onclick="copyAddr('sea')" class="absolute top-2 right-2 px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors" id="copy-btn-sea">&#x1f4cb; Copy</button>
                        <p class="font-bold text-gray-800 text-base">BSS <span class="text-blue-600">{{ customer.sea_code }}</span></p>
                        <p class="text-gray-600 text-sm mt-1">8707 Stansbury Ave.</p>
                        <p class="text-gray-600 text-sm">Van Nuys, CA 91402</p>
                        <p class="text-gray-600 text-sm mt-1">+1 (818) 437-2260</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Example: How to fill in shipping address -->
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-5">
            <h3 class="font-bold text-amber-700 mb-3">&#x1f4dd; ตัวอย่างวิธีกรอกที่อยู่ตอนสั่งของ</h3>
            <p class="text-xs text-amber-600 mb-3">เมื่อสั่งของจากเว็บ US (Amazon, eBay, Nike ฯลฯ) ให้กรอก Shipping Address ดังนี้:</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <p class="text-xs font-semibold text-amber-500 uppercase tracking-wider mb-2">&#x2708;&#xfe0f; ส่งทางอากาศ (Air)</p>
                    <div class="bg-white rounded-lg p-4 border border-amber-200 font-mono text-sm leading-relaxed">
                        <p><span class="text-gray-400">Name:</span> <strong>BSS {{ customer.customer_code }}</strong></p>
                        <p><span class="text-gray-400">Address:</span> 8707 Stansbury Ave.</p>
                        <p><span class="text-gray-400">City:</span> Van Nuys</p>
                        <p><span class="text-gray-400">State:</span> CA</p>
                        <p><span class="text-gray-400">ZIP:</span> 91402</p>
                        <p><span class="text-gray-400">Phone:</span> +1 (818) 437-2260</p>
                    </div>
                </div>
                <div>
                    <p class="text-xs font-semibold text-blue-500 uppercase tracking-wider mb-2">&#x1f6a2; ส่งทางเรือ (Sea)</p>
                    <div class="bg-white rounded-lg p-4 border border-blue-200 font-mono text-sm leading-relaxed">
                        <p><span class="text-gray-400">Name:</span> <strong>BSS {{ customer.sea_code }}</strong></p>
                        <p><span class="text-gray-400">Address:</span> 8707 Stansbury Ave.</p>
                        <p><span class="text-gray-400">City:</span> Van Nuys</p>
                        <p><span class="text-gray-400">State:</span> CA</p>
                        <p><span class="text-gray-400">ZIP:</span> 91402</p>
                        <p><span class="text-gray-400">Phone:</span> +1 (818) 437-2260</p>
                    </div>
                </div>
            </div>
            <div class="mt-4 bg-red-50 border border-red-200 rounded-lg px-4 py-3">
                <p class="text-sm text-red-600 font-semibold">&#x26a0;&#xfe0f; สำคัญ!</p>
                <ul class="text-xs text-red-500 mt-1 space-y-0.5 list-disc list-inside">
                    <li>ช่อง <strong>Name</strong> ต้องใส่ <strong>BSS</strong> ตามด้วย <strong>รหัสลูกค้า</strong> เสมอ (Air = <strong>{{ customer.customer_code }}</strong>, Sea = <strong>{{ customer.sea_code }}</strong>)</li>
                    <li>ถ้าไม่ใส่รหัส ทางเราจะไม่สามารถระบุตัวตนเจ้าของพัสดุได้</li>
                    <li>ส่งทางอากาศ ใช้รหัส Air / ส่งทางเรือ ใช้รหัส Sea — <strong>ห้ามสลับกัน</strong></li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Destination Addresses -->
<div class="bg-white rounded-xl shadow-sm p-6 mb-4 border-2 border-amber-100">
    <div class="flex items-center justify-between mb-4">
        <h2 class="font-semibold text-amber-600">&#x1f1f9;&#x1f1ed; ที่อยู่ปลายทาง (ไทย)</h2>
        <span class="text-xs text-gray-400">{{ addresses|length }}/{{ MAX_ADDRESSES }}</span>
    </div>

    {% for addr in addresses %}
    <div class="border border-gray-100 rounded-lg p-4 mb-3 hover:bg-gray-50">
        <div class="flex items-center justify-between mb-2">
            <span class="font-semibold text-amber-700 text-sm">{{ addr.nickname or 'ที่อยู่' }}{% if addr.is_default %} <span class="text-xs bg-amber-100 text-amber-600 px-1.5 py-0.5 rounded">หลัก</span>{% endif %}</span>
            <div class="flex gap-2">
                <button onclick="toggleEdit({{ addr.id }})" class="text-xs text-blue-500 hover:text-blue-700">&#x270e; แก้ไข</button>
                {% if addresses|length > 1 %}
                <form method="POST" action="/customer/{{ customer.customer_code }}/address/{{ addr.id }}/delete" onsubmit="return confirm('ลบที่อยู่นี้?')">
                    <button type="submit" class="text-xs text-red-400 hover:text-red-600">&#x2715; ลบ</button>
                </form>
                {% endif %}
            </div>
        </div>
        <div class="text-sm text-gray-700" id="addr-view-{{ addr.id }}">
            <p>{{ addr.receiver_first_name }} {{ addr.receiver_last_name }}</p>
            <p class="text-gray-500 text-xs">{{ addr.receiver_address }}</p>
            <p class="text-gray-500 text-xs">{{ addr.receiver_phone }}</p>
        </div>
        <!-- Edit form (hidden) -->
        <form method="POST" action="/customer/{{ customer.customer_code }}/address/{{ addr.id }}/edit" id="addr-edit-{{ addr.id }}" class="hidden mt-3 space-y-2">
            <input type="text" name="nickname" value="{{ addr.nickname }}" placeholder="ชื่อเรียก" class="w-full px-3 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-yellow-500">
            <div class="grid grid-cols-2 gap-2">
                <input type="text" name="receiver_first_name" value="{{ addr.receiver_first_name }}" required class="px-3 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-yellow-500">
                <input type="text" name="receiver_last_name" value="{{ addr.receiver_last_name }}" required class="px-3 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-yellow-500">
            </div>
            <textarea name="receiver_address" required rows="2" class="w-full px-3 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-yellow-500">{{ addr.receiver_address }}</textarea>
            <input type="tel" name="receiver_phone" value="{{ addr.receiver_phone }}" required class="w-full px-3 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-yellow-500">
            <div class="flex gap-2">
                <button type="submit" class="px-4 py-1.5 bg-yellow-500 text-white text-sm rounded hover:bg-yellow-600">บันทึก</button>
                <button type="button" onclick="toggleEdit({{ addr.id }})" class="px-4 py-1.5 bg-gray-100 text-gray-600 text-sm rounded hover:bg-gray-200">ยกเลิก</button>
            </div>
        </form>
    </div>
    {% endfor %}

    <!-- Add new address form -->
    {% if addresses|length < MAX_ADDRESSES %}
    <button onclick="document.getElementById('add-addr-form').classList.toggle('hidden')" class="w-full py-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-400 hover:border-amber-400 hover:text-amber-600 transition-colors text-sm font-medium mt-2">
        + เพิ่มที่อยู่ปลายทาง
    </button>
    <form method="POST" action="/customer/{{ customer.customer_code }}/address/add" id="add-addr-form" class="hidden mt-3 border border-amber-200 rounded-xl p-4 bg-amber-50 space-y-3">
        <h3 class="text-sm font-bold text-amber-700">เพิ่มที่อยู่ใหม่</h3>
        <input type="text" name="nickname" placeholder="ชื่อเรียกสั้นๆ เช่น บ้านห้วยขวาง" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
        <div class="grid grid-cols-2 gap-3">
            <input type="text" name="receiver_first_name" required placeholder="ชื่อผู้รับ" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
            <input type="text" name="receiver_last_name" required placeholder="นามสกุลผู้รับ" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
        </div>
        <textarea name="receiver_address" required rows="2" placeholder="ที่อยู่ผู้รับในไทย" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent"></textarea>
        <input type="tel" name="receiver_phone" required placeholder="เบอร์โทรผู้รับ เช่น 081-234-5678" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
        <button type="submit" class="w-full bg-yellow-500 text-white py-2 rounded-lg font-semibold hover:bg-yellow-600 transition-colors text-sm">เพิ่มที่อยู่</button>
    </form>
    {% endif %}
</div>

<!-- Rate Info -->
<div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-8 flex items-center justify-between flex-wrap gap-3">
    <div class="text-sm">
        <span class="text-gray-500">อัตราค่าขนส่งของคุณ:</span>
        <span class="font-bold text-amber-700 text-lg ml-1">{{ effective_rate }} &#xe3f;/kg</span>
        {% if customer.custom_rate %}<span class="text-xs text-green-600 ml-1">(เรทพิเศษ)</span>{% endif %}
    </div>
    <a href="/calculator" class="text-amber-600 hover:underline text-sm font-medium">&#x1f4b0; เครื่องคิดเลขราคา &rarr;</a>
</div>

<!-- Inbound Packages -->
<div class="bg-white rounded-xl shadow-sm p-6 mb-8 border-2 border-blue-100">
    <div class="flex items-center justify-between mb-4">
        <h2 class="font-semibold text-blue-600">&#x1f4e5; พัสดุขาเข้า (Inbound)</h2>
        <span class="text-xs text-gray-400">สั่งของจาก US &#x2192; BSS Warehouse</span>
    </div>

    <!-- Add inbound form toggle -->
    <button onclick="document.getElementById('add-inbound-form').classList.toggle('hidden')"
        class="w-full py-3 border-2 border-dashed border-blue-200 rounded-xl text-blue-400 hover:border-blue-400 hover:text-blue-600 transition-colors text-sm font-medium mb-4">
        + แจ้ง Tracking พัสดุขาเข้า
    </button>

    <!-- Add inbound form -->
    <form method="POST" action="/customer/{{ customer.customer_code }}/inbound/add"
          id="add-inbound-form" class="hidden mb-4 border border-blue-200 rounded-xl p-4 bg-blue-50 space-y-3">
        <h3 class="text-sm font-bold text-blue-700">&#x1f4e6; แจ้ง Tracking พัสดุที่กำลังมา Warehouse</h3>
        <p class="text-xs text-blue-500">กรอกเลข Tracking จาก Amazon, FedEx, USPS, UPS, DHL ที่กำลังส่งมาที่ BSS Warehouse</p>
        <select name="carrier" required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">-- เลือกขนส่ง --</option>
            {% for key, label in INBOUND_CARRIERS.items() %}
                <option value="{{ key }}">{{ label }}</option>
            {% endfor %}
        </select>
        <input type="text" name="carrier_tracking_number" required
            placeholder="เลข Tracking เช่น 1Z999AA10123456784"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <input type="text" name="description"
            placeholder="รายละเอียด (ไม่บังคับ) เช่น Nike shoes, iPhone case"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <button type="submit"
            class="w-full bg-blue-500 text-white py-2.5 rounded-lg font-semibold hover:bg-blue-600 transition-colors text-sm">
            &#x1f4e5; แจ้งพัสดุขาเข้า
        </button>
    </form>

    <!-- Inbound packages list -->
    {% if inbound_packages %}
    <div class="space-y-3">
        {% for pkg in inbound_packages %}
        <div class="border border-gray-100 rounded-lg p-4 hover:bg-gray-50">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2 flex-wrap">
                    <span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-semibold">
                        {{ INBOUND_CARRIERS.get(pkg.carrier, pkg.carrier) }}
                    </span>
                    <span class="font-mono text-sm text-gray-700">{{ pkg.carrier_tracking_number }}</span>
                </div>
                <div class="flex items-center gap-2">
                    {% if pkg.status == 'received' %}
                        <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">{{ INBOUND_STATUS_MAP[pkg.status] }}</span>
                    {% elif pkg.status == 'processing' %}
                        <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-semibold">{{ INBOUND_STATUS_MAP[pkg.status] }}</span>
                    {% elif pkg.status == 'in_transit' %}
                        <span class="bg-amber-100 text-amber-700 px-2 py-1 rounded-full text-xs font-semibold">{{ INBOUND_STATUS_MAP[pkg.status] }}</span>
                    {% else %}
                        <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs font-semibold">{{ INBOUND_STATUS_MAP[pkg.status] }}</span>
                    {% endif %}
                    {% if pkg.status not in ('received', 'processing') %}
                    <form method="POST" action="/customer/{{ customer.customer_code }}/inbound/{{ pkg.id }}/delete"
                          onsubmit="return confirm('ลบพัสดุขาเข้านี้?')">
                        <button type="submit" class="text-xs text-red-400 hover:text-red-600">&#x2715; ลบ</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% if pkg.description %}
                <p class="text-sm text-gray-500">{{ pkg.description }}</p>
            {% endif %}
            <p class="text-xs text-gray-400 mt-1">
                แจ้งเมื่อ {{ pkg.submitted_at[:10] }}
                {% if pkg.received_at %} &#x2022; รับเมื่อ {{ pkg.received_at[:10] }}{% endif %}
                {% if pkg.notes %} &#x2022; <span class="text-blue-500">{{ pkg.notes }}</span>{% endif %}
            </p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center text-gray-400 py-6">
        <div class="text-2xl mb-1">&#x1f4e5;</div>
        <p class="text-sm">ยังไม่มีพัสดุขาเข้า</p>
        <p class="text-xs text-gray-300 mt-1">สั่งของจากเว็บ US แล้วกด "+ แจ้ง Tracking" ด้านบน</p>
    </div>
    {% endif %}
</div>

<!-- Shipments -->
<h2 class="text-lg font-bold text-gray-800 mb-4">&#x1f4e6; พัสดุล่าสุด</h2>

{% if shipments %}
<div class="bg-white rounded-xl shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">หมายเลขติดตาม</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">รายละเอียด</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ที่อยู่ปลายทาง</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">สถานะ</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">วันที่</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for s in shipments %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3"><a href="/track/{{ s.tracking_number }}" class="text-amber-600 font-medium hover:underline font-mono text-sm">{{ s.tracking_number }}</a></td>
                    <td class="px-4 py-3 text-sm text-gray-700">{{ s.description }}</td>
                    <td class="px-4 py-3">
                        {% if s.dest_nickname %}
                            <span class="text-sm text-gray-700">{{ s.dest_nickname }}</span>
                            {% if s.address_locked_by_customer %}
                                <span class="text-xs text-gray-400">&#x1f512;</span>
                            {% endif %}
                        {% elif s.address_locked_by_customer %}
                            <span class="text-xs text-gray-400">&#x1f512; เลือกแล้ว</span>
                        {% else %}
                            <form method="POST" action="/customer/{{ customer.customer_code }}/shipment/{{ s.id }}/set-address" class="flex gap-1">
                                <select name="address_id" required class="text-xs border border-gray-200 rounded px-1 py-0.5">
                                    <option value="">เลือก...</option>
                                    {% for addr in addresses %}
                                    <option value="{{ addr.id }}">{{ addr.nickname }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="px-2 py-0.5 bg-amber-500 text-white text-xs rounded hover:bg-amber-600">เลือก</button>
                            </form>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3">
                        {% if s.status == 'delivered' %}<span class="inline-block bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>
                        {% elif s.status == 'customs' %}<span class="inline-block bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>
                        {% elif s.status == 'in_transit' %}<span class="inline-block bg-amber-100 text-amber-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>
                        {% else %}<span class="inline-block bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>{% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">{{ s.created_at[:10] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="bg-white rounded-xl shadow-sm p-12 text-center text-gray-400">
    <div class="text-4xl mb-2">&#x1f4ed;</div>
    <p>ยังไม่มีพัสดุ</p>
</div>
{% endif %}

<script>
function toggleEdit(id) {
    document.getElementById('addr-view-' + id).classList.toggle('hidden');
    document.getElementById('addr-edit-' + id).classList.toggle('hidden');
}
function copyAddr(type) {
    const code = type === 'air' ? "{{ customer.customer_code }}" : "{{ customer.sea_code }}";
    const text = "BSS " + code + "\n8707 Stansbury Ave.\nVan Nuys, CA 91402\n+1 (818) 437-2260";
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copy-btn-' + type);
        btn.textContent = '\u2713 Copied!';
        setTimeout(() => btn.innerHTML = '&#x1f4cb; Copy', 2000);
    });
}
</script>
{% endblock %}
