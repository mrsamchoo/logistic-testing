{% extends "base.html" %}
{% block title %}พอร์ทัลลูกค้า — {{ customer.customer_code }}{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-3 flex-wrap">
        <h1 class="text-2xl font-bold text-gray-800">&#x1f464;</h1>
        <span class="bg-amber-100 text-amber-700 px-3 py-1 rounded-lg text-sm font-mono font-bold">&#x2708;&#xfe0f; {{ customer.customer_code }}</span>
        <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-sm font-mono font-bold">&#x1f6a2; {{ customer.sea_code }}</span>
        {% if customer.tier == 'vip' %}
            <span class="bg-yellow-400 text-white px-3 py-1 rounded-lg text-xs font-bold">&#x1f451; VIP</span>
        {% elif customer.tier == 'gold' %}
            <span class="bg-yellow-300 text-yellow-900 px-3 py-1 rounded-lg text-xs font-bold">&#x1f947; Gold</span>
        {% else %}
            <span class="bg-orange-200 text-orange-800 px-3 py-1 rounded-lg text-xs font-bold">&#x1f949; Bronze</span>
        {% endif %}
    </div>
    <a href="/customer/logout" class="text-sm text-gray-500 hover:text-red-500">ออกจากระบบ</a>
</div>

<!-- US Sender → BSS Warehouse -->
<div class="flex flex-col md:flex-row items-stretch gap-0 mb-4">
    <div class="flex-1 bg-white rounded-xl md:rounded-r-none shadow-sm p-6 border-2 border-amber-100">
        <h2 class="font-semibold text-amber-600 mb-3">&#x1f1fa;&#x1f1f8; ผู้ส่ง (อเมริกา)</h2>
        <div class="space-y-1 text-sm text-gray-700">
            <p><span class="text-gray-400">ชื่อผู้ส่ง:</span> <strong>{{ customer.sender_first_name }} {{ customer.sender_last_name }} {{ customer.customer_code }}</strong></p>
            <p><span class="text-gray-400">ที่อยู่:</span> {{ customer.sender_address }}</p>
            <p><span class="text-gray-400">โทร:</span> {{ customer.sender_phone }}</p>
        </div>
    </div>
    <div class="flex items-center justify-center py-3 md:py-0 md:px-2">
        <div class="flex flex-col items-center gap-1">
            <div class="hidden md:flex items-center">
                <div class="w-8 h-0.5 bg-amber-300"></div>
                <div class="bg-yellow-500 text-white rounded-full w-10 h-10 flex items-center justify-center text-lg">&#x1f4e6;</div>
                <div class="w-4 h-0.5 bg-amber-400"></div>
                <div class="text-amber-400 text-2xl">&#x2192;</div>
                <div class="w-4 h-0.5 bg-green-400"></div>
                <div class="bg-green-500 text-white rounded-full w-10 h-10 flex items-center justify-center text-lg">&#x1f3e2;</div>
                <div class="w-8 h-0.5 bg-green-300"></div>
            </div>
            <div class="md:hidden flex items-center gap-1">
                <div class="bg-yellow-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">&#x1f4e6;</div>
                <div class="text-amber-400 text-xl">&#x2193;</div>
                <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm">&#x1f3e2;</div>
            </div>
            <span class="text-xs text-gray-400 font-medium">Ship to BSS</span>
        </div>
    </div>
    <div class="flex-1 bg-white rounded-xl md:rounded-l-none shadow-sm p-6 border-2 border-green-100">
        <h2 class="font-semibold text-green-600 mb-3">&#x1f3e2; ที่อยู่ผู้รับในอเมริกา (BSS Warehouse)</h2>
        <div class="space-y-1 text-sm text-gray-700">
            <p><span class="text-gray-400">ผู้รับ:</span> <strong>BSS <span class="text-amber-600">{{ customer.customer_code }}</span></strong></p>
            <p class="text-xs text-amber-600 bg-amber-50 rounded px-2 py-1 inline-block">&#x1f4a1; จะส่งเรือใช้ <strong>{{ customer.sea_code }}</strong> / ส่งแอร์ใช้ <strong>{{ customer.customer_code }}</strong> (สงสัยสอบถามแอดมิน)</p>
            <p><span class="text-gray-400">ที่อยู่:</span> 8707 Stansbury Ave. Van Nuys CA 91402</p>
            <p><span class="text-gray-400">โทร:</span> +1 (818) 437-2260 <span class="text-xs text-gray-400">(สำหรับกรอกข้อมูลเวลาสั่งของเท่านั้น)</span></p>
            <p class="mt-2 text-xs text-green-600 bg-green-50 rounded px-2 py-1 inline-block">&#x1f4ac; ติดต่อผ่าน Line <strong>@เร็วสุด</strong> มีแอดมินสแตนบายเกือบ 24 ชม.</p>
        </div>
    </div>
</div>

<!-- Thai Receiver -->
<div class="bg-white rounded-xl shadow-sm p-6 mb-4 border-2 border-amber-100">
    <h2 class="font-semibold text-amber-600 mb-3">&#x1f1f9;&#x1f1ed; ผู้รับปลายทาง (ไทย)</h2>
    <div class="space-y-1 text-sm text-gray-700">
        <p><span class="text-gray-400">ชื่อ:</span> {{ customer.receiver_first_name }} {{ customer.receiver_last_name }}</p>
        <p><span class="text-gray-400">ที่อยู่:</span> {{ customer.receiver_address }}</p>
        <p><span class="text-gray-400">โทร:</span> {{ customer.receiver_phone }}</p>
    </div>
</div>

<!-- Rate Info -->
<div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-8 flex items-center justify-between flex-wrap gap-3">
    <div class="text-sm">
        <span class="text-gray-500">อัตราค่าขนส่งของคุณ:</span>
        <span class="font-bold text-amber-700 text-lg ml-1">{{ effective_rate }} &#xe3f;/kg</span>
        {% if customer.custom_rate %}<span class="text-xs text-green-600 ml-1">(เรทพิเศษ)</span>{% endif %}
    </div>
    <a href="/calculator" class="text-amber-600 hover:underline text-sm font-medium">&#x1f4b0; เครื่องคิดเลขราคา &rarr;</a>
</div>

<!-- Shipments -->
<h2 class="text-lg font-bold text-gray-800 mb-4">&#x1f4e6; พัสดุล่าสุด 5 รายการ</h2>

{% if shipments %}
<div class="bg-white rounded-xl shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">หมายเลขติดตาม</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">รายละเอียด</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Port</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">น้ำหนัก</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">สถานะ</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">วันที่</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for s in shipments %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3"><a href="/track/{{ s.tracking_number }}" class="text-amber-600 font-medium hover:underline font-mono text-sm">{{ s.tracking_number }}</a></td>
                    <td class="px-4 py-3 text-sm text-gray-700">{{ s.description }}</td>
                    <td class="px-4 py-3">{% if s.port %}<span class="inline-block bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-mono font-bold">{{ s.port }}</span>{% else %}-{% endif %}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">{{ s.weight }}</td>
                    <td class="px-4 py-3">
                        {% if s.status == 'delivered' %}<span class="inline-block bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>
                        {% elif s.status == 'customs' %}<span class="inline-block bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>
                        {% elif s.status == 'in_transit' %}<span class="inline-block bg-amber-100 text-amber-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>
                        {% else %}<span class="inline-block bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs font-semibold">{{ STATUS_MAP[s.status] }}</span>{% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-500">{{ s.created_at[:10] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="bg-white rounded-xl shadow-sm p-12 text-center text-gray-400">
    <div class="text-4xl mb-2">&#x1f4ed;</div>
    <p>ยังไม่มีพัสดุ</p>
</div>
{% endif %}
{% endblock %}
